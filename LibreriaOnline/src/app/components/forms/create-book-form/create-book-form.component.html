<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
    [ngClass]="{'hidden': !isVisible}" (click)="closeModal()">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white"
        (click)="$event.stopPropagation()">

        <!-- Modal Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-200 rounded-t">
            <h3 class="text-xl font-semibold text-gray-800">
                Crear Nuevo Libro
            </h3>
            <button (click)="closeModal()"
                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>

        <!-- Modal Body -->
        <form [formGroup]="bookForm" (ngSubmit)="onSubmit()" class="p-6">
            <!-- Título y Autor -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Título *</label>
                    <input type="text" formControlName="title"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('title')?.invalid && bookForm.get('title')?.touched">
                    @if (getFieldError('title')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('title') }}
                    </div>
                    }
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Autor *</label>
                    <input type="text" formControlName="author"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('author')?.invalid && bookForm.get('author')?.touched">
                    @if (getFieldError('author')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('author') }}
                    </div>
                    }
                </div>
            </div>

            <!-- Descripción -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Descripción *</label>
                <textarea formControlName="description" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    [class.border-red-500]="bookForm.get('description')?.invalid && bookForm.get('description')?.touched">
        </textarea>
                @if (getFieldError('description')) {
                <div class="text-red-500 text-xs mt-1">
                    {{ getFieldError('description') }}
                </div>
                }
            </div>

            <!-- Precio y Calificación -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Precio *</label>
                    <input type="number" formControlName="price" step="0.01" min="0"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('price')?.invalid && bookForm.get('price')?.touched">
                    @if (getFieldError('price')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('price') }}
                    </div>
                    }
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Calificación (0-5)</label>
                    <input type="number" formControlName="rating" step="0.1" min="0" max="5"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('rating')?.invalid && bookForm.get('rating')?.touched">
                    @if (getFieldError('rating')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('rating') }}
                    </div>
                    }
                </div>
            </div>

            <!-- Género y Año de Publicación -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Género *</label>
                    <select formControlName="genre"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('genre')?.invalid && bookForm.get('genre')?.touched">
                        <option value="">Seleccione un género</option>
                        @for (genre of genres; track genre) {
                        <option [value]="genre.name">
                            {{ genre.name }}
                        </option>
                        }
                    </select>
                    @if (getFieldError('genre')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('genre') }}
                    </div>
                    }
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Año de Publicación *</label>
                    <input type="number" formControlName="publicationYear" min="1000" [max]="maxYear"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('publicationYear')?.invalid && bookForm.get('publicationYear')?.touched">
                    @if (getFieldError('publicationYear')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('publicationYear') }}
                    </div>
                    }
                </div>
            </div>

            <!-- Páginas e ISBN -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Páginas *</label>
                    <input type="number" formControlName="pages" min="1"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('pages')?.invalid && bookForm.get('pages')?.touched">
                    @if (getFieldError('pages')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('pages') }}
                    </div>
                    }
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ISBN *</label>
                    <input type="text" formControlName="isbn"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        [class.border-red-500]="bookForm.get('isbn')?.invalid && bookForm.get('isbn')?.touched">
                    @if (getFieldError('isbn')) {
                    <div class="text-red-500 text-xs mt-1">
                        {{ getFieldError('isbn') }}
                    </div>
                    }
                </div>
            </div>

            <!-- Selector de Imagen -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Portada del Libro *</label>

                <!-- Input de archivo oculto -->
                <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" class="hidden">

                <!-- Área de arrastrar y soltar o botón para seleccionar -->
                <div (click)="fileInput.click()"
                    class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors"
                    [class.border-red-500]="bookForm.get('coverImage')?.invalid && bookForm.get('coverImage')?.touched">

                    @if (selectedFileName) {
                    <div class="flex items-center justify-center">
                        <svg class="w-8 h-8 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        <span class="text-green-600 font-medium">{{ selectedFileName }}</span>
                    </div>
                    } @else {
                    <div>
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
                            viewBox="0 0 48 48">
                            <path
                                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">
                            <span class="font-medium text-blue-600">Haz clic para seleccionar</span> una imagen
                        </p>
                        <p class="text-xs text-gray-500">PNG, JPG, GIF hasta 10MB</p>
                    </div>
                    }
                </div>

                <!-- Input oculto para almacenar la URL temporal o base64 -->
                <input type="hidden" formControlName="coverImage">

                @if (getFieldError('coverImage')) {
                <div class="text-red-500 text-xs mt-1">
                    {{ getFieldError('coverImage') }}
                </div>
                }
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
                <button type="button" (click)="closeModal()"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Cancelar
                </button>
                <button type="submit" [disabled]="bookForm.invalid"
                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
                    Crear Libro
                </button>
            </div>
        </form>
    </div>
</div>